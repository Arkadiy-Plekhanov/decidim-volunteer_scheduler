<!-- Volunteer Profile Card using Decidim native components -->
<section class="volunteer-profile">
  <!-- Profile Header with Gradient -->
  <div class="profile-header">
    <div class="profile-info">
      <div class="profile-avatar">
        <%= icon "user-smile-line", class: "w-8 h-8 text-white", role: "img", "aria-label": t(".profile_icon") %>
      </div>
      <div class="profile-details flex-1">
        <h2><%= model.user.name %></h2>
        <p>@<%= model.user.nickname %></p>
      </div>
      <div class="profile-level">
        <div class="level-badge">
          <%= t("decidim.volunteer_scheduler.common.level_number", level: model.level) %>
        </div>
        <div class="level-label">
          <%= t("decidim.volunteer_scheduler.common.xp").capitalize %>: <%= number_with_delimiter(model.total_xp) %>
        </div>
      </div>
    </div>

    <!-- XP Progress Bar -->
    <div class="xp-progress-container">
      <div class="progress-label">
        <span class="progress-text text-white">
          <%= t(".level_progress_label", level: model.level, default: "Прогресс уровня #{model.level}") %>
        </span>
        <span class="progress-numbers text-white">
          <%= current_level_xp %>/<%= current_level_xp + next_level_xp_needed %> <%= t("decidim.volunteer_scheduler.common.xp") %>
        </span>
      </div>

      <div class="progress-bar">
        <div class="progress-meter" style="width: <%= progress_percentage %>%"></div>
      </div>
    </div>
  </div>

  <!-- Statistics Grid using Decidim's native statistic pattern -->
  <div class="volunteer-stats">
    <div class="statistic__container">
      <% stats_data.each do |stat| %>
        <div class="statistic" data-statistic>
          <div class="statistic__header">
            <div class="statistic__title"><%= stat[:label] %></div>
            <div class="statistic__icon">
              <%= icon stat[:icon], class: "fill-current", role: "img", "aria-label": stat[:label] %>
            </div>
          </div>
          <div class="statistic__number"><%= stat[:value] %></div>
          <% if stat[:secondary] %>
            <div class="statistic__second-number"><%= stat[:secondary] %></div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Referral Link Section -->
  <div class="referral-stats-card mt-6">
    <div class="card">
      <div class="card__content p-6">
        <div class="text-center space-y-4">
          <h4 class="text-lg font-semibold"><%= t(".share_referral_link") %></h4>
          <p class="text-sm opacity-75"><%= t(".invite_friends") %></p>

          <div class="max-w-md mx-auto space-y-4">
            <!-- Referral Code Input with Copy Button -->
            <div class="flex items-center gap-2">
              <input
                type="text"
                value="<%= referral_url(model) %>"
                readonly
                class="referral-code-input flex-1"
                id="referral-link"
                aria-label="<%= t('.referral_link_label') %>">
              <button
                onclick="copyReferralLink()"
                class="copy-button"
                type="button"
                aria-label="<%= t('.copy') %>">
                <%= icon "file-copy-line", class: "w-4 h-4 mr-1", role: "img" %>
                <span class="button-text"><%= t(".copy") %></span>
              </button>
            </div>

            <!-- Quick Share Buttons -->
            <div class="flex justify-center gap-2">
              <button
                onclick="shareViaTwitter()"
                class="button button__sm button__transparent-secondary"
                type="button"
                title="<%= t(".share_on_twitter") %>">
                <%= icon "share-line", class: "w-4 h-4 mr-1", role: "img" %>
                <%= t(".tweet") %>
              </button>
              <button
                onclick="shareViaEmail()"
                class="button button__sm button__transparent-secondary"
                type="button"
                title="<%= t(".share_via_email") %>">
                <%= icon "mail-send-line", class: "w-4 h-4 mr-1", role: "img" %>
                <%= t(".email") %>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  function copyReferralLink() {
    const input = document.getElementById('referral-link');
    const button = event.target.closest('button');
    const originalHTML = button.innerHTML;

    // Copy to clipboard
    input.select();
    input.setSelectionRange(0, 99999); // For mobile devices

    try {
      document.execCommand('copy');

      // Visual feedback
      button.classList.add('copied');
      button.innerHTML = '<%= icon "check-line", class: "w-4 h-4 mr-1" %> <%= t(".copied_button") %>';

      setTimeout(() => {
        button.innerHTML = originalHTML;
        button.classList.remove('copied');
      }, 2000);
    } catch (err) {
      console.error('Failed to copy:', err);
    }

    // Deselect
    window.getSelection().removeAllRanges();
  }

  function shareViaTwitter() {
    const url = document.getElementById('referral-link').value;
    const text = "<%= t('.twitter_share_text') %>";
    const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
    window.open(twitterUrl, '_blank', 'width=550,height=420');
  }

  function shareViaEmail() {
    const url = document.getElementById('referral-link').value;
    const subject = "<%= t('.email_subject') %>";
    const body = "<%= t('.email_body', url: '${url}') %>".replace('${url}', url);
    const emailUrl = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    window.location.href = emailUrl;
  }
</script>
