<!-- Volunteer Profile Card following Decidim patterns with better large screen layout -->
<section class="volunteer-profile mb-8">
  <!-- Container to keep content centered on large screens -->
  <div class="max-w-4xl mx-auto">
    
    <!-- Profile Header Card -->
    <div class="card card--full">
      <div class="card__header">
        <div class="flex items-center justify-between p-6">
          <div class="flex items-center">
            <div class="flex-shrink-0">
              <%= icon "user-smile-line", class: "w-12 h-12 text-secondary" %>
            </div>
            <div class="ml-4">
              <h2 class="text-xl font-semibold text-secondary"><%= model.user.name %></h2>
              <p class="text-sm text-gray-2">@<%= model.user.nickname %></p>
            </div>
          </div>
          <div class="text-right">
            <div class="text-2xl font-bold text-success"><%= t(".level_label", level: model.level, default: "Level #{model.level}") %></div>
            <div class="text-sm text-gray-2"><%= t("decidim.volunteer_scheduler.common.xp").capitalize %>: <%= number_with_delimiter(model.total_xp) %></div>
          </div>
        </div>
      </div>

      <!-- XP Progress Bar -->
      <div class="card__content px-6 pb-6">
        <div class="space-y-2">
          <div class="flex justify-between items-center">
            <span class="text-sm font-medium text-gray-2">
              <%= t(".level_progress_label", level: model.level, default: "Level #{model.level} Progress") %>
            </span>
            <span class="text-xs text-gray-3">
              <%= current_level_xp %>/<%= current_level_xp + next_level_xp_needed %> <%= t("decidim.volunteer_scheduler.common.xp") %>
            </span>
          </div>
          
          <div class="progress-bar bg-gray-1 h-3 rounded-full overflow-hidden">
            <div class="progress-meter bg-success h-full rounded-full transition-all duration-500" 
                 style="width: <%= progress_percentage %>%"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Stats Section using Decidim's statistic pattern with better grid -->
    <div class="mt-6">
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
        <% stats_data.each do |stat| %>
          <div class="statistic bg-white rounded-lg border border-gray-1 p-4" data-statistic>
            <div class="statistic__header mb-3">
              <div class="statistic__metric">
                <div class="statistic__title text-sm font-medium text-gray-2 mb-1" title="<%= stat[:label] %>">
                  <%= stat[:label] %>
                </div>
              </div>
              <div class="statistic__icon flex justify-end">
                <%= icon stat[:icon], class: "w-5 h-5 text-primary fill-current" %>
              </div>
            </div>
            <div class="statistic__number text-2xl font-bold text-secondary">
              <%= stat[:value] %>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Referral Link Section with improved styling -->
    <div class="card card--full mt-6">
      <div class="card__content p-6">
        <div class="text-center">
          <h4 class="text-lg font-semibold text-secondary mb-4"><%= t(".share_referral_link") %></h4>
          <p class="text-sm text-gray-2 mb-4"><%= t(".invite_friends") %></p>
          
          <div class="max-w-md mx-auto">
            <div class="flex items-center space-x-2">
              <input type="text" 
                     value="<%= referral_url(model) %>" 
                     readonly 
                     class="form__input flex-1 text-xs font-mono bg-gray-1 text-gray-2 text-center" 
                     id="referral-link">
              <button onclick="copyReferralLink()"
                      class="button button--sm button--secondary flex-shrink-0"
                      type="button">
                <%= icon "file-copy-line", class: "w-4 h-4 mr-1" %>
                <%= t(".copy") %>
              </button>
            </div>
            
            <!-- Quick share buttons -->
            <div class="flex justify-center space-x-2 mt-4">
              <button onclick="shareViaTwitter()"
                      class="button button--sm button--ghost"
                      type="button"
                      title="<%= t(".share_on_twitter") %>">
                <%= icon "share-line", class: "w-4 h-4" %>
                <%= t(".tweet") %>
              </button>
              <button onclick="shareViaEmail()"
                      class="button button--sm button--ghost"
                      type="button"
                      title="<%= t(".share_via_email") %>">
                <%= icon "mail-send-line", class: "w-4 h-4" %>
                <%= t(".email") %>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
  </div>
</section>

<script>
  function copyReferralLink() {
    const input = document.getElementById('referral-link');
    input.select();
    document.execCommand('copy');
    
    // Visual feedback
    const button = event.target.closest('button');
    const originalHTML = button.innerHTML;
    button.innerHTML = '<%= icon "check-line", class: "w-4 h-4 mr-1" %> <%= t(".copied_button") %>';
    button.classList.add('button--success');
    
    setTimeout(() => {
      button.innerHTML = originalHTML;
      button.classList.remove('button--success');
    }, 2000);
  }
  
  function shareViaTwitter() {
    const url = document.getElementById('referral-link').value;
    const text = "<%= t('.twitter_share_text') %>";
    const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
    window.open(twitterUrl, '_blank');
  }

  function shareViaEmail() {
    const url = document.getElementById('referral-link').value;
    const subject = "<%= t('.email_subject') %>";
    const body = "<%= t('.email_body', url: '${url}') %>".replace('${url}', url);

    const emailUrl = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    window.location.href = emailUrl;
  }
</script>