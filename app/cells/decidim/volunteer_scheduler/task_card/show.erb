<!-- Task Card using Decidim's native card__grid pattern -->
<div class="card__grid ring-4 ring-background hover:ring-tertiary transition-all relative">

  <!-- Status Badge (Top Right) -->
  <% if already_accepted? %>
    <span class="task-status-badge label success">
      <%= icon "check-line", class: "w-3 h-3", role: "img" %>
      <%= t(".already_accepted") %>
    </span>
  <% elsif !can_accept? %>
    <span class="task-status-badge label alert">
      <%= icon "lock-line", class: "w-3 h-3", role: "img" %>
      <%= t("decidim.volunteer_scheduler.common.level_number", level: task_template.level_required) %>
    </span>
  <% end %>

  <div class="card__grid-text">
    <!-- Title and Difficulty Badge -->
    <div class="card__grid-text-title mb-3">
      <h3 class="text-lg font-semibold"><%= task_template.title %></h3>
      <span class="task-difficulty <%= difficulty_class %> label mt-2">
        <%= difficulty_label %>
      </span>
    </div>

    <!-- Description -->
    <p class="text-sm opacity-75 mb-4 line-clamp-3">
      <%= truncate(task_template.description, length: 150) %>
    </p>

    <!-- Metadata Grid -->
    <div class="card__grid-metadata space-y-2">
      <!-- XP Reward -->
      <div class="flex items-center gap-2">
        <%= icon "star-line", class: "w-4 h-4 text-warning", role: "img", "aria-label": t(".xp_reward") %>
        <span class="font-semibold text-warning"><%= task_template.xp_reward %> <%= t("decidim.volunteer_scheduler.common.xp") %></span>
      </div>

      <!-- Level Required -->
      <div class="flex items-center gap-2">
        <%= icon "trophy-line", class: "w-4 h-4", role: "img", "aria-label": t(".level_required") %>
        <span class="text-sm"><%= t("decidim.volunteer_scheduler.common.level_number", level: task_template.level_required) %>+</span>
      </div>

      <!-- Estimated Time -->
      <div class="flex items-center gap-2">
        <%= icon "time-line", class: "w-4 h-4", role: "img", "aria-label": t(".estimated_time") %>
        <span class="text-sm"><%= estimated_time %></span>
      </div>
    </div>

    <!-- Action Button -->
    <div class="mt-4 pt-4 border-t border-gray">
      <% if can_accept? %>
        <%= link_to accept_task_path,
                   method: :post,
                   class: "button button__sm button__secondary w-full",
                   data: { confirm: t(".accept_confirm") } do %>
          <%= icon "check-line", class: "w-4 h-4 mr-1", role: "img" %>
          <%= t(".accept_task") %>
        <% end %>
      <% elsif already_accepted? %>
        <div class="callout" style="padding: 0.75rem; margin: 0;">
          <div class="flex items-center gap-2 text-sm">
            <%= icon "checkbox-circle-line", class: "w-4 h-4 text-secondary", role: "img" %>
            <span><%= t(".task_in_progress") %></span>
          </div>
        </div>
      <% else %>
        <div class="callout alert" style="padding: 0.75rem; margin: 0;">
          <div class="flex items-center gap-2 text-sm">
            <%= icon "lock-line", class: "w-4 h-4", role: "img" %>
            <span><%= t(".level_requirement_not_met") %></span>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
